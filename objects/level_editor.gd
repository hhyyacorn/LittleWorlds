extends Node2D


const in_edit_mode: bool = false
var current_level_name = "reality"

var level_info = {
	"reality" = {
		"fk_times": "[[1.28966, 3.240136, 7.141088, 9.191565, 14.591795, 29.916961, 30.56712, 32.517596, 33.817914, 34.468073, 35.76839, 37.068707, 43.570295, 46.821088, 48.121406, 50.722041, 51.3722, 53.322676, 55.273152, 56.573469, 61.12458, 65.675692, 66.976009, 67.626168, 72.827438, 74.777914, 83.229977, 83.880136, 88.431247, 89.731565, 92.3322, 94.282676, 94.932834, 97.533469, 98.833787, 100.784263, 103.384898, 104.035057, 105.985533, 107.28585, 109.886485, 115.087755, 117.038231, 118.338549, 119.638866, 122.88966, 123.539819, 131.991882, 133.2922, 133.942358, 134.592517, 143.694739, 144.344898, 145.645215, 151.496644, 152.146803, 152.796961, 153.44712],
		[1.939819, 3.890295, 5.190612, 22.115057, 23.415374, 24.045215, 25.36585, 26.666168, 27.316327, 33.167755, 41.619819, 42.269977, 49.421723, 55.923311, 58.523946, 66.32585, 71.52712, 76.078231, 80.629342, 81.279501, 81.92966, 86.480771, 87.13093, 87.781088, 89.081406, 90.381723, 91.031882, 102.08458, 102.734739, 104.685215, 105.335374, 106.635692, 108.586168, 109.236327, 111.836961, 113.137279, 116.388073, 118.988707, 121.589342, 124.189977, 124.840136, 126.140454, 128.741088, 129.391247, 132.642041, 135.242676, 137.193152, 139.143628, 139.793787, 143.04458, 147.595692, 148.896009, 149.546168, 154.097279, 155.397596, 156.047755, 156.697914],
		[16.541159, 20.16458, 24.715692, 27.966485, 28.616644, 31.867438, 39.019184, 39.669342, 40.319501, 44.220454, 47.471247, 48.771565, 52.022358, 57.223628, 57.873787, 59.824263, 64.375374, 68.276327, 68.926485, 70.226803, 73.477596, 77.378549, 78.678866, 79.329025, 79.979184, 84.530295, 85.180454, 85.830612, 91.682041, 96.883311, 100.134104, 107.936009, 110.516327, 111.186803, 113.787438, 114.437596, 115.737914, 117.68839, 120.268707, 122.239501, 125.490295, 126.790612, 127.440771, 130.041406, 130.691565, 135.892834, 136.542993, 137.843311, 142.394422, 144.995057, 146.295374, 146.945533, 150.196327, 154.747438, 157.348073, 157.998231, 158.64839],
		[2.589977, 4.540454, 5.840771, 6.49093, 11.241, 11.891159, 13.291477, 15.891, 17.543628, 18.864263, 21.464898, 26.016009, 29.266803, 31.217279, 35.118231, 36.418549, 37.718866, 38.369025, 40.96966, 42.920136, 44.870612, 45.520771, 46.17093, 50.071882, 52.672517, 53.972834, 54.622993, 59.174104, 60.474422, 61.774739, 62.424898, 63.075057, 63.725215, 65.025533, 69.576644, 70.876961, 72.177279, 74.127755, 76.72839, 78.028707, 82.579819, 92.982358, 93.632517, 95.582993, 96.233152, 98.183628, 99.483946, 101.434422, 112.48712, 120.939184, 128.09093, 131.341723, 138.493469, 141.094104, 141.744263, 148.24585, 150.846485]]",
		"music": load("res://music/Hannah-bgm.ogg")
	}
}

func _ready():
		
		$MusicPlayer.stream = level_info.get(current_level_name).get("music")
		$MusicPlayer.play()
		$MusicPlayer.finished.connect(_on_song_finished)
		
		if in_edit_mode:
			pass
		else:
			var fk_times = level_info.get(current_level_name).get("fk_times")
			var fk_times_arr = str_to_var(fk_times)
			
			var counter: int =0
			for key in fk_times_arr:
				
				var button_name: String = ""
				match counter:
					0:
						button_name = "button_W"
					1:
						button_name = "button_A"
					2:
						button_name = "button_S"
					3:
						button_name = "button_D"
				
				for delay in key:
					SpawnFallingKey(button_name,delay)
					
				counter += 1
				
func _on_song_finished():
	end_level()

func end_level():
	pass

func SpawnFallingKey(button_name: String, delay: float):
	await get_tree().create_timer(delay).timeout
	Signals.CreateFallingKey.emit(button_name)
